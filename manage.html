<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8" />
  <title>添加项目</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
  <script>
    window._AMapSecurityConfig = {
      securityJsCode: "5fd8a936c191f539f49b6abf555b7f60",
    };
  </script>
  <script src="https://webapi.amap.com/loader.js"></script>
</head>
<body>
  <header class="site-header">
    <h1>添加项目</h1>
  </header>

  <main class="container">
    <form id="wish-form" class="form">
      <div class="form-group">
        <label for="name" id="name-label">名称 *</label>
        <input id="name" name="name" type="text" required />
        <input type="hidden" id="lng" name="lng" />
        <input type="hidden" id="lat" name="lat" />
      </div>

      <div class="form-group" id="rating-container">
        <label>星级（1-5） *</label>
        <div class="rating-group">
          <label class="rating-option">
            <input type="radio" name="rating" value="0" checked />
            <span>不设置星级</span>
          </label>
          <label class="rating-option">
            <input type="radio" name="rating" value="1" />
            <span>★☆☆☆☆</span>
          </label>
          <label class="rating-option">
            <input type="radio" name="rating" value="2" />
            <span>★★☆☆☆</span>
          </label>
          <label class="rating-option">
            <input type="radio" name="rating" value="3" />
            <span>★★★☆☆</span>
          </label>
          <label class="rating-option">
            <input type="radio" name="rating" value="4" />
            <span>★★★★☆</span>
          </label>
          <label class="rating-option">
            <input type="radio" name="rating" value="5" />
            <span>★★★★★</span>
          </label>
        </div>
      </div>

      <div id="food-fields">
        <div class="form-group">
          <label for="mealType">餐别</label>
          <select id="mealType" class="meal-type-select" name="mealType">
            <option value="">请选择</option>
            <option value="早餐">早餐</option>
            <option value="正餐">正餐</option>
            <option value="小吃">小吃</option>
            <option value="甜品">甜品</option>
          </select>
        </div>

        <div class="form-group">
          <label for="cuisine">菜系</label>
          <input
            id="cuisine"
            name="cuisine"
            type="text"
            placeholder="例如：港式、粤菜、茶餐厅、日料等"
          />
        </div>

        <div class="form-group">
          <label for="location">地点 *</label>
          <input
            id="location"
            name="location"
            type="text"
            placeholder="例如：尖沙咀、中环、旺角"
            required
          />
        </div>

        <div class="form-group">
          <label for="food-cost">预计费用</label>
          <div class="input-with-suffix">
            <input
              id="food-cost"
              name="foodCost"
              type="text"
              class="short-input"
              placeholder="例如：150"
            />
            <span class="input-suffix">人民币</span>
          </div>
        </div>
      </div>

      <div id="place-fields" hidden>
        <div class="form-group">
          <label for="playTime">游玩时间 *</label>
          <div class="input-with-suffix">
            <input
              id="playTime"
              class="playtime-input"
              name="playTime"
              type="text"
              inputmode="numeric"
              pattern="\d+(\.\d+)?"
              placeholder="2 或 1.5"
              required
            />
            <span class="input-suffix">h</span>
          </div>
        </div>

        <div class="form-group">
          <label for="place-location">地点 *</label>
          <input
            id="place-location"
            name="placeLocation"
            type="text"
            placeholder="例如：尖沙咀、中环、旺角"
            required
          />
        </div>

        <div class="form-group">
          <label for="place-cost">预计费用</label>
          <div class="input-with-suffix">
            <input
              id="place-cost"
              name="placeCost"
              type="text"
              class="short-input"
              placeholder="例如：300"
            />
            <span class="input-suffix">人民币</span>
          </div>
        </div>
      </div>

      <div id="transport-fields" hidden>
        <div class="form-group">
          <label>在途时间 *</label>
          <div class="time-input-group">
            <div class="input-wrapper">
              <input
                id="travelTimeH"
                name="travelTimeH"
                type="number"
                min="0"
                value="0"
                class="short-input"
                required
              />
              <span>h</span>
            </div>
            <div class="input-wrapper">
              <input
                id="travelTimeM"
                name="travelTimeM"
                type="number"
                min="0"
                max="59"
                value="0"
                class="short-input"
                required
              />
              <span>min</span>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="transport-cost">预计费用</label>
          <div class="input-with-suffix">
            <input
              id="transport-cost"
              name="transportCost"
              type="text"
              class="short-input"
              placeholder="例如：150"
            />
            <span class="input-suffix">人民币</span>
          </div>
        </div>
      </div>

      <div id="stay-fields" hidden>
        <div class="form-group">
          <label for="stay-location">地点 *</label>
          <input
            id="stay-location"
            name="stayLocation"
            type="text"
            placeholder="例如：尖沙咀、中环、旺角"
            required
          />
        </div>

        <div class="form-group">
          <label for="stay-cost">预计费用</label>
          <div class="input-with-suffix">
            <input
              id="stay-cost"
              name="stayCost"
              type="text"
              class="short-input"
              placeholder="例如：800"
            />
            <span class="input-suffix">人民币</span>
          </div>
        </div>
      </div>

      <div class="form-group" id="keywords-container">
        <label for="keywords">备注</label>
        <input
          id="keywords"
          name="keywords"
          type="text"
          placeholder="例如：环境安静、适合家庭出行"
        />
      </div>

      <section class="map-section" id="map-section-container">
        <h2>地图选点（高德）</h2>
        <div class="form-group">
          <label for="map-search">搜索地点</label>
          <input
            id="map-search"
            name="map-search"
            type="text"
            placeholder="输入想去的地点，例如：铜锣湾、太平山顶"
          />
        </div>
        <div id="map-container"></div>
        <p class="map-hint">在地图上点击或选择搜索结果，将自动填充名称和地点。</p>
      </section>

      <div class="form-actions">
        <button id="submit-btn" type="submit" class="btn btn-primary">确认添加</button>
        <a id="cancel-link" href="planner.html" class="btn btn-secondary">返回清单</a>
      </div>
    </form>
  </main>

  <script src="auth-manager.js"></script>
  <script src="main.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const urlParams = new URLSearchParams(window.location.search);
      let planId = urlParams.get('planId');
      
      // Fallback for legacy links (Add mode only)
      if (!planId && urlParams.get('type')) {
          planId = urlParams.get('id');
      }

      if (planId) {
          HKWL.setCurrentPlan(planId);
      }
      
      HKWL.initManagePage();

      if (planId) {
          const cancelLink = document.getElementById('cancel-link');
          if (cancelLink) {
              if (cancelLink.href.includes('?')) {
                  cancelLink.href += `&id=${planId}`;
              } else {
                  cancelLink.href += `?id=${planId}`;
              }
          }
      }
    });
  </script>
</body>
</html>
